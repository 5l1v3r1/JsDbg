<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>JsDbg</title>
    <script src="/jsdbg/loader.js" type="text/javascript"></script>
    <style>
        h3, h4, h5, p {
            margin:0;
        }

        input {
            width:30em;
        }

        p.author {
            font-size:0.8em;
        }

        .unload {
            font-size:8pt;
            font-weight:normal;
            cursor:pointer;
            color:gray;
        }
        .unload::before {
            content:"[unload]";
        }

        .unload:hover {
            color:blue;
        }

        li {
            margin:1em;
        }
    </style>
    <script type="text/javascript">
        function realizeExtension(ext) {
            if (ext.headless) {
                return;
            }

            var ul = document.querySelector("ul");
            var li = document.createElement("li");
            li.className = "loadedExtension";
            li.innerHTML = "<h3><a href='/" + ext.name.toLowerCase() + "/'>" + ext.name + "</a> </h3>" + 
                (ext.author ? "<p class='author'>" + ext.author + "</p>" : "") +
                (ext.description ? "<p class='description'>" + ext.description + "</p>" : "");
            ul.appendChild(li);
        }

        function reloadExtensions() {
            var loadedExtensions = document.querySelectorAll("li.loadedExtension");
            for (var i = 0; i < loadedExtensions.length; ++i) {
                loadedExtensions[i].parentNode.removeChild(loadedExtensions[i]);
            }

            JsDbg.GetExtensions(function(result) { 
                result.extensions.sort(function(a, b) { return a.name.localeCompare(b.name); });
                result.extensions.forEach(realizeExtension); 
            });
        }

        Loader.OnPageReady(function() {
            // Get any startup extensions.
            JsDbg.GetPersistentData(null, function(data) {
                if (typeof(data) == typeof({}) && "_CATALOG-extension-manager" in data) {
                    var extensions = data["_CATALOG-extension-manager"];
                    if (extensions.startup && Array.isArray(extensions.startup) && extensions.startup.length > 0) {
                        var remainingLoads = extensions.startup.length;
                        extensions.startup.forEach(function (path) {
                            JsDbg.LoadExtension(path, function() {
                                if (--remainingLoads == 0) {
                                    reloadExtensions();
                                }
                            });
                        });
                    } else {
                        reloadExtensions();
                    }
                } else {
                    reloadExtensions();
                }
            });
        });
    </script>
</head>
<body>
    <ul>
    </ul>
</body>
</html>